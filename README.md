# DK2Stats
Parse Door Kickers 2 game files and do some statistics on them.
The project consists of multiple sub-components that can either be imported as library, or (in some cases) run from the terminal to do some processing.

# Installation and Dependencies
This project uses the built-in Python libraries (tested on 3.8, but may also work on older versions), as well as BeautifulSoup 4 to parse the game's XML files.
If you have Python and Pip installed, you can get BeautifulSoup with:

    pip3 install beautifulsoup4
     
or, if you're on Windows:

    python -m pip install beautifulsoup4
    
# Modules
These modules build upon each other, and can be imported into your own projects, or into an interactive Python session (simply type `python` or possibly `python3` in the console, while in the same directory as the scripts). Function names should be pretty self-explanatory, and can be found by looking at the code (don't be afraid, it's short, and Python is very readable).

## extract.py
This module reads the game files and extracts the data into a format that's easier to use. It is built around a `Data` class that represents the parsed game files. It can also be run in the console with the path to the Door Kickers 2 (or mod) data directory as parameter to list the names of all relevant game items.
Usage example:

    from extract import Data
    data = Data("C:/Games/DoorKickers2/data")
    data.list_scopes_for("M4 Carbine")

## weapon.py
This module contains a `Weapon` class that wraps the parsed XML structure and presents simple methods to read the stats. Since most of the stats are in some way distance-dependent, thes methods usually accept distance to target (in meters) as the first parameter, defaulting to 10 m if none is provided. Times are returned in milliseconds.
Usage example:

    from weapon import *
    data = Data("C:/Games/DoorKickers2/data")
    M4_Mk318_Holo = Weapon(data,"M4 Carbine",ammo="556FMJMk318_M4",scope="Holosight")
    M4_Mk318_Holo.crit_chance(25)
    ak = Weapon(data,"Type 56")
    ak.accuracy(50)

There is also a `Cached` class that can be used to cache function calls to other classes for a significant speedup in simulations (so the game files don't have to be searched again and again for the same value). Simply use it to wrap the `Weapon` object:

    ak_cached = Cached(ak)
    ak_cached.aim_time(30)

## simulate.py
This module calculates the probabilities for various outcomes (e.g. How much damage a burst from a specific weapon does, and how long it takes). It is built around the `Event` class, which represents a dictionary of `(time,damage)` pairs mapped to their respective probability. The events also contain a few useful methods to calculate, for example, the DPS, or the median time to kill a target. Events are generated by calling the `one_shot`, `one_burst` and `one_mag` function with the used `Weapon`, distance to target and a few optional parameters like target hp, armor and cover. The latter two functions will by default collapse all outcomes into a single event, but by passing `collapsed=False` will instead split the outcomes into individual events by the number of shots fired. Do note that the `one_mag` function can take a long time to complete when used with weapons that fire long bursts and have large magazines (i.e. machine guns).
Usage example:

    from simulate import *
    data = Data("C:/Games/DoorKickers2/data")
    M4_Mk318_Holo = Weapon(data,"M4 Carbine",ammo="556FMJMk318_M4",scope="Holosight")
    M4_Mk318_Holo.one_burst(20,armor=(4,40))

## stats.py
This module contains a few helper functions to tabulate weapon stats and write them to a CSV file that can be imported into most spreadsheet programs. Calling it from the command line with the path to the game's data directory will create tables of most relevant distance-dependant stats for all weapons in the game. Be aware thet the later ones in the list require a lot of calculations that can take a rather long time for some weapons (especially the RPKs). You can comment them out or filter the weapons used to save some time.
`match_weapons` will generate a list of `Weapon` objects that match the criteria in the parameters (leaving one out or passing `None` matches anything).
`all_cutoffs` will merge distance cutoffs in the weapon stats (caused by switches in attack types and scope settings), since these require some additional care in preparing the x-axis of the tables.
`x_axis` will generate the distances at which weapon stats should be calculated to give a good representation, splitting the graph at all cutoff points in the weapon stats.
`make_table` will calculate and assemble a CSV table of the stats of all passed weapons and distances using any function that takes a weapon and a distance and returns a number. There are some examples at the bottom of the file, but don't be afraid to write your own.
